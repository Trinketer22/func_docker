name: "Check toncli"
on:
  workflow_dispatch:
jobs:
  check-commit:
    runs-on: ubuntu-latest
    steps:
      - id: toncli_cur
        name: Current commit
        run: echo "commit=$(git ls-remote https://github.com/disintar/toncli master | awk '{print $1}')" >> $GITHUB_OUTPUT
      - id: cache
        name: Check cache
        uses: actions/cache@v3
        with:
          path: prev_commit.txt
          key: toncli-${{steps.toncli_cur.outputs.commit}}

      - name: Update cache
        if: steps.cache.outputs.cache-hit != 'true'
        name: Update commit
        run: echo ${{steps.toncli_cur.outputs.commit}} > prev_commit.txt
      - name: Trigger update toncli
        if: steps.cache.outputs.cache-hit != 'true'
        run: curl -X POST -H -H "Accept: application/vnd.github+json" -H "Authorization: Bearer ${{secrets.GITHUB_TOKEN}}" https://api.github.com/repos/Trinketer22/func_docker/actions/workflows/test.yml/dispatches
